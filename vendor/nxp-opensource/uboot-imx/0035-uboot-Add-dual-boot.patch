From 9cb4ad1d39beabacb268f680c03b8ac15042deac Mon Sep 17 00:00:00 2001
From: Kirill Kapranov <kirill.kapranov@compulab.co.il>
Date: Sun, 4 Apr 2021 23:17:13 +0300
Subject: [PATCH 35/35] uboot: Add dual boot

Signed-off-by: Kirill Kapranov <kirill.kapranov@compulab.co.il>
---
 configs/ucm-imx8m-mini-android_defconfig | 8 +++++++-
 include/configs/ucm-imx8m-mini.h         | 3 +++
 2 files changed, 10 insertions(+), 1 deletion(-)

diff --git a/configs/ucm-imx8m-mini-android_defconfig b/configs/ucm-imx8m-mini-android_defconfig
index 8a40909f40..2f19079dbb 100644
--- a/configs/ucm-imx8m-mini-android_defconfig
+++ b/configs/ucm-imx8m-mini-android_defconfig
@@ -1,5 +1,5 @@
 CONFIG_LOCALVERSION_AUTO=n
-CONFIG_LOCALVERSION="-1.3.4"
+CONFIG_LOCALVERSION="-1.3.4-dual"
 CONFIG_ARM=y
 CONFIG_ARCH_IMX8M=y
 CONFIG_SYS_TEXT_BASE=0x40200000
@@ -33,8 +33,12 @@ CONFIG_CMD_I2C=y
 CONFIG_CMD_CACHE=y
 # CONFIG_CMD_LED is not set
 CONFIG_CMD_REGULATOR=y
+CONFIG_CMD_EXT2=y
+CONFIG_CMD_EXT4=y
+CONFIG_CMD_FAT=y
 CONFIG_CMD_FS_GENERIC=y
 CONFIG_EFI_PARTITION=y
+CONFIG_PARTITION_TYPE_GUID=y
 CONFIG_OF_CONTROL=y
 CONFIG_IMX8M_LPDDR4=y
 CONFIG_ENV_IS_IN_MMC=y
@@ -50,6 +54,8 @@ CONFIG_DM_SPI_FLASH=y
 CONFIG_SPI_FLASH=y
 CONFIG_SPI_FLASH_STMICRO=y
 CONFIG_DM_ETH=y
+CONFIG_USB_HOST_ETHER=y
+CONFIG_USB_ETHER_ASIX88179=y
 CONFIG_PINCTRL=y
 CONFIG_PINCTRL_IMX8M=y
 CONFIG_DM_REGULATOR=y
diff --git a/include/configs/ucm-imx8m-mini.h b/include/configs/ucm-imx8m-mini.h
index e9f29d4762..fcd344fc73 100644
--- a/include/configs/ucm-imx8m-mini.h
+++ b/include/configs/ucm-imx8m-mini.h
@@ -139,6 +139,8 @@
 	"mmcautodetect=yes\0" \
 	"emmc_ul=setenv iface mmc; setenv dev 1; setenv part 1;" \
 	"setenv bootargs console=${console} root=/dev/mmcblk2p2;\0" \
+	"ulandroid=if load mmc ${dev}:5 $loadaddr default.prop; then env def -a;" \
+	"boota; fi\0" \
 	"sd_ul=setenv iface mmc; setenv dev 0; setenv part 1;" \
 	"setenv bootargs console=${console} root=/dev/mmcblk1p2;\0" \
 	"usb_ul=usb start; setenv iface usb; setenv dev 0; setenv part 1;" \
@@ -187,6 +189,7 @@
 			"fi; " \
 		"fi; " \
 	"done; " \
+	"run ulandroid; "\
 	"usb start; ums 0 mmc ${mmcdev};"
 
 /* Link Definitions */
-- 
2.11.0

